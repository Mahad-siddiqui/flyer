{
  "version": 3,
  "sources": [],
  "sections": [
    {"offset": {"line": 6, "column": 0}, "map": {"version":3,"sources":[],"names":[],"mappings":"","debugId":null}},
    {"offset": {"line": 154, "column": 0}, "map": {"version":3,"sources":["file:///C:/Users/DT/Documents/perfect/perfect/src/lib/prisma.ts"],"sourcesContent":["import { PrismaClient } from '@prisma/client'\n\nconst globalForPrisma = globalThis as unknown as {\n  prisma: PrismaClient | undefined\n}\n\nexport const prisma = globalForPrisma.prisma ?? new PrismaClient({\n  log: ['query'],\n})\n\nif (process.env.NODE_ENV !== 'production') globalForPrisma.prisma = prisma"],"names":[],"mappings":";;;AAAA;;AAEA,MAAM,kBAAkB;AAIjB,MAAM,SAAS,gBAAgB,MAAM,IAAI,IAAI,6HAAA,CAAA,eAAY,CAAC;IAC/D,KAAK;QAAC;KAAQ;AAChB;AAEA,wCAA2C,gBAAgB,MAAM,GAAG","debugId":null}},
    {"offset": {"line": 170, "column": 0}, "map": {"version":3,"sources":["file:///C:/Users/DT/Documents/perfect/perfect/src/lib/auth.ts"],"sourcesContent":["import { NextAuthOptions } from \"next-auth\";\nimport { PrismaAdapter } from \"@next-auth/prisma-adapter\";\nimport GoogleProvider from \"next-auth/providers/google\";\nimport CredentialsProvider from \"next-auth/providers/credentials\";\nimport bcrypt from \"bcryptjs\";\nimport { prisma } from \"./prisma\";\n\nexport const authOptions: NextAuthOptions = {\n  adapter: PrismaAdapter(prisma),\n  providers: [\n    GoogleProvider({\n      clientId: process.env.GOOGLE_CLIENT_ID!,\n      clientSecret: process.env.GOOGLE_CLIENT_SECRET!,\n    }),\n    CredentialsProvider({\n      name: \"credentials\",\n      credentials: {\n        email: { label: \"Email\", type: \"email\" },\n        password: { label: \"Password\", type: \"password\" }\n      },\n      async authorize(credentials) {\n        if (!credentials?.email || !credentials?.password) {\n          return null;\n        }\n\n        const user = await prisma.user.findUnique({\n          where: { email: credentials.email },\n          include: {\n            plan: true,\n            _count: {\n              select: { flyers: true },\n            },\n          },\n        });\n\n        if (!user || !user.password) {\n          return null;\n        }\n\n        const isPasswordValid = await bcrypt.compare(\n          credentials.password,\n          user.password\n        );\n\n        if (!isPasswordValid) {\n          return null;\n        }\n\n        return {\n          id: user.id,\n          email: user.email,\n          name: user.name,\n          image: user.image,\n          planId: user.planId,\n          subscriptionStatus: user.subscriptionStatus,\n          flyersUsed: user.flyersUsed,\n          plan: user.plan,\n          flyerCount: user._count.flyers,\n        };\n      },\n    }),\n  ],\n  callbacks: {\n    async jwt({ token, user, account }) {\n      // Persist user data in JWT token\n      if (user) {\n        token.id = user.id;\n        token.planId = user.planId;\n        token.subscriptionStatus = user.subscriptionStatus;\n        token.flyersUsed = user.flyersUsed;\n        token.plan = user.plan;\n        token.flyerCount = user.flyerCount;\n      }\n      return token;\n    },\n    async session({ session, token }) {\n      // Send properties to the client\n      session.user = {\n        ...session.user,\n        id: token.id as string,\n        planId: token.planId as string,\n        subscriptionStatus: token.subscriptionStatus as string,\n        flyersUsed: token.flyersUsed as number,\n        plan: token.plan as any,\n        flyerCount: token.flyerCount as number,\n      };\n      return session;\n    },\n    async signIn({ user, account, profile }) {\n      try {\n        if (account?.provider === \"google\") {\n          const existingUser = await prisma.user.findUnique({\n            where: { email: user.email! },\n          });\n\n          if (!existingUser) {\n            // Create free plan for new users\n            const freePlan = await prisma.plan.findFirst({\n              where: { name: \"Free\" },\n            });\n\n            if (freePlan) {\n              await prisma.user.update({\n                where: { email: user.email! },\n                data: { planId: freePlan.id },\n              });\n            }\n          }\n        }\n        return true;\n      } catch (error) {\n        console.error(\"Error during sign in:\", error);\n        return false;\n      }\n    },\n  },\n  pages: {\n    signIn: \"/auth/signin\",\n    error: \"/auth/error\",\n  },\n  session: {\n    strategy: \"jwt\", // Changed from \"database\" to \"jwt\"\n    maxAge: 30 * 24 * 60 * 60, // 30 days\n  },\n};"],"names":[],"mappings":"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","debugId":null}},
    {"offset": {"line": 313, "column": 0}, "map": {"version":3,"sources":["file:///C:/Users/DT/Documents/perfect/perfect/src/app/api/flyers/route.ts"],"sourcesContent":["import { NextRequest, NextResponse } from \"next/server\";\nimport { getServerSession } from \"next-auth\";\nimport { authOptions } from \"@/lib/auth\";\nimport { prisma } from \"@/lib/prisma\";\n\nexport async function GET(request: NextRequest) {\n  try {\n    const session = await getServerSession(authOptions);\n\n    if (!session?.user?.id) {\n      return NextResponse.json({ error: \"Unauthorized\" }, { status: 401 });\n    }\n\n    const { searchParams } = new URL(request.url);\n    const limit = parseInt(searchParams.get(\"limit\") || \"10\");\n    const page = parseInt(searchParams.get(\"page\") || \"1\");\n    const category = searchParams.get(\"category\");\n\n    const offset = (page - 1) * limit;\n\n    const where = {\n      userId: session.user.id,\n      ...(category && { category }),\n    };\n\n    const [flyers, totalCount] = await Promise.all([\n      prisma.flyer.findMany({\n        where,\n        select: {\n          id: true,\n          title: true,\n          category: true,\n          viewCount: true,\n          createdAt: true,\n          generatedUrl: true,\n          qrCodePath: true,\n          isPublic: true,\n          originalFileName: true,\n          fileType: true,\n        },\n        orderBy: { createdAt: \"desc\" },\n        take: limit,\n        skip: offset,\n      }),\n      prisma.flyer.count({ where }),\n    ]);\n\n    return NextResponse.json({\n      flyers,\n      totalCount,\n      totalPages: Math.ceil(totalCount / limit),\n      currentPage: page,\n    });\n  } catch (error) {\n    console.error(\"Flyers API error:\", error);\n    return NextResponse.json(\n      { error: \"Internal server error\" },\n      { status: 500 }\n    );\n  }\n}\n\nexport async function POST(request: NextRequest) {\n  try {\n    const session = await getServerSession(authOptions);\n\n    if (!session?.user?.id) {\n      return NextResponse.json({ error: \"Unauthorized\" }, { status: 401 });\n    }\n\n    const userId = session.user.id;\n\n    // Check user's plan limits\n    const user = await prisma.user.findUnique({\n      where: { id: userId },\n      include: {\n        plan: true,\n        _count: {\n          select: { flyers: true },\n        },\n      },\n    });\n\n    if (!user) {\n      return NextResponse.json({ error: \"User not found\" }, { status: 404 });\n    }\n\n    // Check if user has reached their plan limit\n    if (\n      user.plan?.flyerLimit !== -1 &&\n      user._count.flyers >= (user.plan?.flyerLimit || 5)\n    ) {\n      return NextResponse.json(\n        { error: \"Plan limit reached. Please upgrade your plan.\" },\n        { status: 403 }\n      );\n    }\n\n    const body = await request.json();\n    const {\n      title,\n      originalFileName,\n      filePath,\n      fileType,\n      fileSize,\n      extractedData,\n      category,\n      templateId,\n    } = body;\n\n    // Generate short URL\n    const shortUrl = Math.random().toString(36).substring(2, 10);\n    const generatedUrl = `${process.env.NEXTAUTH_URL}/f/${shortUrl}`;\n\n    const flyer = await prisma.flyer.create({\n      data: {\n        userId,\n        title,\n        originalFileName,\n        filePath,\n        fileType,\n        fileSize,\n        extractedData,\n        category,\n        templateId,\n        generatedUrl,\n        shortUrl,\n      },\n    });\n\n    // Update user's flyer count\n    await prisma.user.update({\n      where: { id: userId },\n      data: { flyersUsed: { increment: 1 } },\n    });\n\n    return NextResponse.json(flyer, { status: 201 });\n  } catch (error) {\n    console.error(\"Create flyer error:\", error);\n    return NextResponse.json(\n      { error: \"Internal server error\" },\n      { status: 500 }\n    );\n  }\n}\n"],"names":[],"mappings":";;;;AAAA;AACA;AACA;AACA;;;;;AAEO,eAAe,IAAI,OAAoB;IAC5C,IAAI;QACF,MAAM,UAAU,MAAM,CAAA,GAAA,uIAAA,CAAA,mBAAgB,AAAD,EAAE,oHAAA,CAAA,cAAW;QAElD,IAAI,CAAC,SAAS,MAAM,IAAI;YACtB,OAAO,gIAAA,CAAA,eAAY,CAAC,IAAI,CAAC;gBAAE,OAAO;YAAe,GAAG;gBAAE,QAAQ;YAAI;QACpE;QAEA,MAAM,EAAE,YAAY,EAAE,GAAG,IAAI,IAAI,QAAQ,GAAG;QAC5C,MAAM,QAAQ,SAAS,aAAa,GAAG,CAAC,YAAY;QACpD,MAAM,OAAO,SAAS,aAAa,GAAG,CAAC,WAAW;QAClD,MAAM,WAAW,aAAa,GAAG,CAAC;QAElC,MAAM,SAAS,CAAC,OAAO,CAAC,IAAI;QAE5B,MAAM,QAAQ;YACZ,QAAQ,QAAQ,IAAI,CAAC,EAAE;YACvB,GAAI,YAAY;gBAAE;YAAS,CAAC;QAC9B;QAEA,MAAM,CAAC,QAAQ,WAAW,GAAG,MAAM,QAAQ,GAAG,CAAC;YAC7C,sHAAA,CAAA,SAAM,CAAC,KAAK,CAAC,QAAQ,CAAC;gBACpB;gBACA,QAAQ;oBACN,IAAI;oBACJ,OAAO;oBACP,UAAU;oBACV,WAAW;oBACX,WAAW;oBACX,cAAc;oBACd,YAAY;oBACZ,UAAU;oBACV,kBAAkB;oBAClB,UAAU;gBACZ;gBACA,SAAS;oBAAE,WAAW;gBAAO;gBAC7B,MAAM;gBACN,MAAM;YACR;YACA,sHAAA,CAAA,SAAM,CAAC,KAAK,CAAC,KAAK,CAAC;gBAAE;YAAM;SAC5B;QAED,OAAO,gIAAA,CAAA,eAAY,CAAC,IAAI,CAAC;YACvB;YACA;YACA,YAAY,KAAK,IAAI,CAAC,aAAa;YACnC,aAAa;QACf;IACF,EAAE,OAAO,OAAO;QACd,QAAQ,KAAK,CAAC,qBAAqB;QACnC,OAAO,gIAAA,CAAA,eAAY,CAAC,IAAI,CACtB;YAAE,OAAO;QAAwB,GACjC;YAAE,QAAQ;QAAI;IAElB;AACF;AAEO,eAAe,KAAK,OAAoB;IAC7C,IAAI;QACF,MAAM,UAAU,MAAM,CAAA,GAAA,uIAAA,CAAA,mBAAgB,AAAD,EAAE,oHAAA,CAAA,cAAW;QAElD,IAAI,CAAC,SAAS,MAAM,IAAI;YACtB,OAAO,gIAAA,CAAA,eAAY,CAAC,IAAI,CAAC;gBAAE,OAAO;YAAe,GAAG;gBAAE,QAAQ;YAAI;QACpE;QAEA,MAAM,SAAS,QAAQ,IAAI,CAAC,EAAE;QAE9B,2BAA2B;QAC3B,MAAM,OAAO,MAAM,sHAAA,CAAA,SAAM,CAAC,IAAI,CAAC,UAAU,CAAC;YACxC,OAAO;gBAAE,IAAI;YAAO;YACpB,SAAS;gBACP,MAAM;gBACN,QAAQ;oBACN,QAAQ;wBAAE,QAAQ;oBAAK;gBACzB;YACF;QACF;QAEA,IAAI,CAAC,MAAM;YACT,OAAO,gIAAA,CAAA,eAAY,CAAC,IAAI,CAAC;gBAAE,OAAO;YAAiB,GAAG;gBAAE,QAAQ;YAAI;QACtE;QAEA,6CAA6C;QAC7C,IACE,KAAK,IAAI,EAAE,eAAe,CAAC,KAC3B,KAAK,MAAM,CAAC,MAAM,IAAI,CAAC,KAAK,IAAI,EAAE,cAAc,CAAC,GACjD;YACA,OAAO,gIAAA,CAAA,eAAY,CAAC,IAAI,CACtB;gBAAE,OAAO;YAAgD,GACzD;gBAAE,QAAQ;YAAI;QAElB;QAEA,MAAM,OAAO,MAAM,QAAQ,IAAI;QAC/B,MAAM,EACJ,KAAK,EACL,gBAAgB,EAChB,QAAQ,EACR,QAAQ,EACR,QAAQ,EACR,aAAa,EACb,QAAQ,EACR,UAAU,EACX,GAAG;QAEJ,qBAAqB;QACrB,MAAM,WAAW,KAAK,MAAM,GAAG,QAAQ,CAAC,IAAI,SAAS,CAAC,GAAG;QACzD,MAAM,eAAe,GAAG,QAAQ,GAAG,CAAC,YAAY,CAAC,GAAG,EAAE,UAAU;QAEhE,MAAM,QAAQ,MAAM,sHAAA,CAAA,SAAM,CAAC,KAAK,CAAC,MAAM,CAAC;YACtC,MAAM;gBACJ;gBACA;gBACA;gBACA;gBACA;gBACA;gBACA;gBACA;gBACA;gBACA;gBACA;YACF;QACF;QAEA,4BAA4B;QAC5B,MAAM,sHAAA,CAAA,SAAM,CAAC,IAAI,CAAC,MAAM,CAAC;YACvB,OAAO;gBAAE,IAAI;YAAO;YACpB,MAAM;gBAAE,YAAY;oBAAE,WAAW;gBAAE;YAAE;QACvC;QAEA,OAAO,gIAAA,CAAA,eAAY,CAAC,IAAI,CAAC,OAAO;YAAE,QAAQ;QAAI;IAChD,EAAE,OAAO,OAAO;QACd,QAAQ,KAAK,CAAC,uBAAuB;QACrC,OAAO,gIAAA,CAAA,eAAY,CAAC,IAAI,CACtB;YAAE,OAAO;QAAwB,GACjC;YAAE,QAAQ;QAAI;IAElB;AACF","debugId":null}}]
}